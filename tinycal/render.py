from unicodedata import east_asian_width

from .color import Color


border_template = {
        'template': [
            '┏━──────────────────────────┳┓',
            '┃        March 2020         ┃┃',
            '┃━━──┳─────────────────────━┃┃',
            '┃ WK ╋ Su Mo Tu We Th Fr Sa ┃┃',
            '┃ 10 ┃  1  2  3  4  5  6  7 ┃┃',
            '│ 11 │  8  9 10 11 12 13 14 ││',
            '│ 12 │ 15 16 17 18 19 20 21 ││',
            '│ 13 │ 22 23 24 25 26 27 28 ││',
            '│ 14 │ 29 30 31             ││',
            '┣━──────────────────────────╋┫',
            '┗━──────────────────────────┻┛',
            ],
        'ascii': [
            '.----------------------------.',
            '|           Title           ||',
            '| ------------------------- ||',
            '| WK | 日 月 火 水 木 金 土 ||',
            '| 10 |  1  2  3  4  5  6  7 ||',
            '| 11 |  8  9 10 11 12 13 14 ||',
            '| 12 | 15 16 17 18 19 20 21 ||',
            '| 13 | 22 23 24 25 26 27 28 ||',
            '| 14 | 29 30 31             ||',
            '|---------------------------+|',
            "'----------------------------'",
            ],
        'single': [
            '┌───────────────────────────┬┐',
            '│        March 2020         ││',
            '│────┬──────────────────────││',
            '│ WK ┼ Su Mo Tu We Th Fr Sa ││',
            '│ 10 │  1  2  3  4  5  6  7 ││',
            '│ 11 │  8  9 10 11 12 13 14 ││',
            '│ 12 │ 15 16 17 18 19 20 21 ││',
            '│ 13 │ 22 23 24 25 26 27 28 ││',
            '│ 14 │ 29 30 31             ││',
            '├───────────────────────────┼┤',
            '└───────────────────────────┴┘',
            ],
        'bold': [
            '┏━━━━━━━━━━━━━━━━━━━━━━━━━━━┳┓',
            '┃        March 2020         ┃┃',
            '┃━━━━┳━━━━━━━━━━━━━━━━━━━━━━┃┃',
            '┃ WK ╋ Su Mo Tu We Th Fr Sa ┃┃',
            '┃ 10 ┃  1  2  3  4  5  6  7 ┃┃',
            '┃ 11 ┃  8  9 10 11 12 13 14 ┃┃',
            '┃ 12 ┃ 15 16 17 18 19 20 21 ┃┃',
            '┃ 13 ┃ 22 23 24 25 26 27 28 ┃┃',
            '┃ 14 ┃ 29 30 31             ┃┃',
            '┣━━━━━━━━━━━━━━━━━━━━━━━━━━━╋┫',
            '┗━━━━━━━━━━━━━━━━━━━━━━━━━━━┻┛',
            ],
        'double': [
            '╔═══════════════════════════╦╗',
            '║         2020              ║║',
            '║────┬──────────────────────║║',
            '║ WK ┼ Su Mo Tu We Th Fr Sa ║║',
            '║ 10 │  1  2  3  4  5  6  7 ║║',
            '║ 11 │  8  9 10 11 12 13 14 ║║',
            '║ 12 │ 15 16 17 18 19 20 21 ║║',
            '║ 13 │ 22 23 24 25 26 27 28 ║║',
            '║ 14 │ 29 30 31             ║║',
            '╠═══════════════════════════╬╣',
            '╚═══════════════════════════╩╝',
            ],
        }


class TinyCalTableTextNode:
    def __init__(self, text):
        self.color = Color('')
        self.text = str(text)

    def __len__(self):
        return len(self.text)

    def __str__(self):
        return self.color(self.text)


def str_width(s):
    return sum(1 + (east_asian_width(c) in 'WF') for c in s)


def render_classic(conf, tr, cal_table):
    for cal_row in cal_table:
        for cal_cell in cal_row:
            print(cal_cell.title)
            for text_row in cal_cell:
                print(str(text_row.wk).rjust(2), end='')
                for n in text_row:
                    print(n, end='')
                print()
